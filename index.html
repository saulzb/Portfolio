<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Saul Zidulka-Bejcek - Snapping Sections</title>

<!-- Google Font: Michroma -->
<link href="https://fonts.googleapis.com/css2?family=Michroma&display=swap" rel="stylesheet">

<style>
/* Global page behavior */
html, body {
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  font-family:'Archivo Expanded', sans-serif;
  background:#111;
  color:#eee;
  scroll-behavior: smooth;
  overflow-x: hidden;
  scroll-snap-type: y mandatory;
}

/* Every snap section */
section {
  width:100%;
  height:100vh;
  box-sizing:border-box;
  position:relative;
  display:flex;
  flex-direction:column;
  scroll-snap-align: start;
  overflow:hidden;
}

/* HERO */
#hero {
  background:url('SAULZIDULKA-BEJCEK.png') center/cover no-repeat;
}

.arrow {
  color:#fff;
  font-size:1.5rem;
  display:flex;
  flex-direction:column;
  align-items:center;
  cursor:pointer;
  user-select:none;
  z-index:10;
  position:absolute;
}
.arrow span { font-size:0.8rem; margin-top:5px; }
.arrow-down { bottom:40px; left:50%; transform:translateX(-50%); }

/* Headings with lines — Michroma */
section h2 {
  margin: 0;
  width:100%;
  text-align:center;
  color:white;
  font-family:'Michroma', sans-serif;
  font-size:1rem;
  letter-spacing:0.5px;
  padding-top: 0;
}
section h2::before,
section h2::after {
  content:"";
  display:inline-block;
  width:18%;            
  height:1px;
  background:white;
  vertical-align:middle;
  margin:0 8px;
}

/* Featured sections */
.featured-section {
  display:flex;
  flex-direction:column;
  justify-content:flex-start;
  overflow:hidden;
  padding-top: 90px;
}

/* Category Sections */
.category-section {
  display:flex;
  flex-direction:column;
  justify-content:flex-start;
  align-items:center;
  overflow:hidden;
  padding-top: 90px;
}

/* Photo rows */
.featured-row,
.category-row {
  height:38vh;
  max-height:38vh;
  display:flex;
  width:max-content;
  gap:10px;
}

.featured-row:first-of-type,
.category-row:first-of-type {
  margin-top: 40px;
}

.featured-row img,
.category-row img {
  height:100%;
  width:auto;
  object-fit:cover;
  border-radius:6px;
}

@keyframes scroll-right {
  0% { transform: translateX(-50%); }
  100% { transform: translateX(0); }
}

/* ---------------- LIGHTBOX ---------------- */
#lightboxOverlay {
  position: fixed;
  top:0; left:0;
  width:100vw; height:100vh;
  background: rgba(0,0,0,0.92);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

#lightboxOverlay img {
  max-width:90vw;
  max-height:90vh;
  border-radius:4px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.6);
}

.lightbox-arrow {
  position:fixed;
  top:50%;
  transform:translateY(-50%);
  font-size:48px;
  color:white;
  cursor:pointer;
  user-select:none;
  z-index:10000;
  padding:10px;
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  outline: none !important;
}

#lightbox-prev { left:30px; }
#lightbox-next { right:30px; }

#lightbox-close {
  position:fixed;
  top:20px;
  right:30px;
  font-size:42px;
  cursor:pointer;
  z-index:10001;
  color:white;
  background:transparent !important;
  border:none !important;
  box-shadow:none !important;
  outline:none !important;
}
</style>
</head>

<body>

<!-- HERO -->
<section id="hero">
  <div class="arrow arrow-down">↓<span>Photos</span></div>
</section>

<!-- Photo sections injected here -->
<div id="photoSections"></div>

<!-- LIGHTBOX ELEMENTS -->
<div id="lightboxOverlay" aria-hidden="true" role="dialog">
  <button id="lightbox-close" aria-label="Close">×</button>
  <button id="lightbox-prev" class="lightbox-arrow" aria-label="Previous">❮</button>
  <img id="lightbox-img" src="" alt="">
  <button id="lightbox-next" class="lightbox-arrow" aria-label="Next">❯</button>
</div>

<script>
/* Scroll down from hero */
document.querySelector('.arrow-down').onclick = () =>
  document.querySelector('#photoSections section')?.scrollIntoView({ behavior:'smooth' });

/* Contentful setup */
const SPACE_ID = '5w319pzc4eiq';
const ACCESS_TOKEN = 'l_S14vNHPLKqDVzZDxMSlO3g3AhMne9mAvyC74dyetg';
const ENVIRONMENT = 'master';

/* Fetch and populate */
async function fetchPhotos(){
  const url=`https://cdn.contentful.com/spaces/${SPACE_ID}/environments/${ENVIRONMENT}/entries?content_type=photo&access_token=${ACCESS_TOKEN}&order=sys.createdAt&include=1`;

  const res = await fetch(url);
  if(!res.ok){ console.error("Failed Contentful fetch"); return; }

  const data = await res.json();

  const assets = {};
  data.includes?.Asset?.forEach(a => assets[a.sys.id] = a.fields.file.url);

  const photosData = data.items.map(item => {
    const f = item.fields;
    return {
      title: f.title,
      photo: f.photo ? `https:${assets[f.photo.sys.id]}` : "",
      thumbnail: f.thumbnail ? `https:${assets[f.thumbnail.sys.id]}` : "",
      category: f.category || "",
      featured: f.featured || false
    };
  });

  displayPhotos(photosData);
}

function displayPhotos(photosData){
  const container = document.getElementById("photoSections");

  const categories = [
    "Featured",
    "Light",
    "Travel",
    "Wildlife",
    "Double Exposures",
    "Water",
  ];

  categories.forEach(cat => {
    const items = cat === "Featured"
      ? photosData.filter(p => p.featured)
      : photosData.filter(p => p.category === cat);

    if (!items.length) return;

    const section = document.createElement("section");
    section.className = cat === "Featured" ? "featured-section" : "category-section";
    section.innerHTML = `<h2>${cat}</h2>`;

    if (cat === "Featured") {
      const mid = Math.ceil(items.length / 2);
      [items.slice(0, mid), items.slice(mid)].forEach(rowItems => {
        const row = document.createElement("div");
        row.className = "featured-row";

        [...rowItems, ...rowItems].forEach(p => {
          const img = document.createElement("img");
          img.src = p.thumbnail || p.photo;
          img.alt = p.title;
          img.dataset.full = p.photo || p.thumbnail; // full-res for lightbox
          row.appendChild(img);
        });

        row.style.animation = `scroll-right ${30 + rowItems.length * 5}s linear infinite`;
        section.appendChild(row);
      });
    } else {
      const mid = Math.ceil(items.length / 2);
      [items.slice(0, mid), items.slice(mid)].forEach(rowItems => {
        const row = document.createElement("div");
        row.className = "category-row";

        rowItems.forEach(p => {
          const img = document.createElement("img");
          img.src = p.thumbnail || p.photo;
          img.alt = p.title;
          img.dataset.full = p.photo || p.thumbnail; // full-res for lightbox
          row.appendChild(img);
        });

        section.appendChild(row);
      });
    }

    container.appendChild(section);
  });

  initArrowKeys();
  setTimeout(enableLightbox, 300);
}

/* Arrow key navigation */
function initArrowKeys() {
  const sections = Array.from(document.querySelectorAll('section'));
  let currentIndex = 0;

  window.addEventListener('scroll', () => {
    sections.forEach((sec, i) => {
      const rect = sec.getBoundingClientRect();
      if (rect.top >= 0 && rect.top < window.innerHeight / 2) {
        currentIndex = i;
      }
    });
  });

  window.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      if (currentIndex < sections.length - 1) {
        currentIndex++;
        sections[currentIndex].scrollIntoView({ behavior: 'smooth' });
      }
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      if (currentIndex > 0) {
        currentIndex--;
        sections[currentIndex].scrollIntoView({ behavior: 'smooth' });
      }
    }
  });
}

/* ---------------- LIGHTBOX ---------------- */

let lbImages = [];
let lbIndex = 0;

function enableLightbox() {
  const sections = document.querySelectorAll(".category-section, .featured-section");
  sections.forEach(section => {
    const imgs = Array.from(section.querySelectorAll("img"));
    imgs.forEach(img => {
      if (img._hasLightbox) return;
      img._hasLightbox = true;

      img.addEventListener("click", () => {
        // lightbox contains all images in current category section
        const allImgs = Array.from(section.querySelectorAll("img"));
        lbImages = allImgs.map(i => i.dataset.full);
        lbIndex = allImgs.indexOf(img);
        openLightbox();
      });
    });
  });

  const overlay = document.getElementById("lightboxOverlay");
  const closeBtn = document.getElementById("lightbox-close");
  const prevBtn = document.getElementById("lightbox-prev");
  const nextBtn = document.getElementById("lightbox-next");

  if (closeBtn && !closeBtn._attached) {
    closeBtn.addEventListener("click", closeLightbox);
    closeBtn._attached = true;
  }
  if (prevBtn && !prevBtn._attached) {
    prevBtn.addEventListener("click", prevLB);
    prevBtn._attached = true;
  }
  if (nextBtn && !nextBtn._attached) {
    nextBtn.addEventListener("click", nextLB);
    nextBtn._attached = true;
  }

  if (overlay && !overlay._outsideClickAttached) {
    overlay.addEventListener("click", (e) => {
      if (e.target === overlay) closeLightbox();
    });
    overlay._outsideClickAttached = true;
  }
}

function openLightbox() {
  const overlay = document.getElementById("lightboxOverlay");
  const imgEl = document.getElementById("lightbox-img");
  if (!overlay || !imgEl || lbImages.length === 0) return;

  imgEl.src = lbImages[lbIndex] || "";
  overlay.style.display = "flex";
  overlay.setAttribute("aria-hidden", "false");
}

function closeLightbox() {
  const overlay = document.getElementById("lightboxOverlay");
  const imgEl = document.getElementById("lightbox-img");
  if (!overlay) return;
  overlay.style.display = "none";
  overlay.setAttribute("aria-hidden", "true");
  if (imgEl) imgEl.src = "";
}

function nextLB() {
  if (lbImages.length === 0) return;
  lbIndex = Math.min(lbImages.length - 1, lbIndex + 1);
  openLightbox();
}

function prevLB() {
  if (lbImages.length === 0) return;
  lbIndex = Math.max(0, lbIndex - 1);
  openLightbox();
}

window.addEventListener("keydown", (e) => {
  const overlay = document.getElementById("lightboxOverlay");
  if (!overlay || overlay.style.display !== "flex") return;

  if (e.key === "ArrowRight") {
    nextLB();
    e.preventDefault();
  } else if (e.key === "ArrowLeft") {
    prevLB();
    e.preventDefault();
  } else if (e.key === "Escape") {
    closeLightbox();
    e.preventDefault();
  }
});

fetchPhotos();
</script>

</body>
</html>
