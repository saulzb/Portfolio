<script>
// ---------- ELEMENTS ----------
const container = document.getElementById('container');
const hero = document.getElementById('hero');
const music = document.getElementById('music');
const drawings = document.getElementById('drawings');
const photos = document.getElementById('photos');

const arrowRight = hero.querySelector('.arrow-right');
const arrowLeft  = hero.querySelector('.arrow-left');
const arrowDown  = hero.querySelector('.arrow-down');

const arrowBackLeft  = music.querySelector('.arrow-back-left');
const arrowBackRight = drawings.querySelector('.arrow-back-right');
const arrowBackUp    = document.querySelector('.arrow-back-up');

// ---------- ARROW CLICK LOGIC ----------
// Horizontal arrows (Hero → Music/Drawings)
arrowRight.addEventListener('click', ()=>container.scrollTo({left: window.innerWidth, behavior:'smooth'}));
arrowLeft.addEventListener('click', ()=>container.scrollTo({left: -window.innerWidth, behavior:'smooth'}));

// Down arrow (Hero → Photos)
arrowDown.addEventListener('click', ()=>{
  const firstSection = document.querySelector('#categories .category-section');
  if(firstSection) firstSection.scrollIntoView({behavior:'smooth'});
});

// Back arrows (Branches → Hero)
arrowBackLeft.addEventListener('click', ()=>container.scrollTo({left:0, behavior:'smooth'}));
arrowBackRight.addEventListener('click', ()=>container.scrollTo({left:0, behavior:'smooth'}));
arrowBackUp.addEventListener('click', ()=>window.scrollTo({top:0, behavior:'smooth'}));

// ---------- HORIZONTAL SNAP ON SCROLL ----------
container.addEventListener('scroll', ()=>{
  const scrollLeft = container.scrollLeft;
  const width = window.innerWidth;
  if(scrollLeft < width/2){
    container.scrollTo({left:0, behavior:'smooth'});
  } else if(scrollLeft < width + width/2){
    container.scrollTo({left:width, behavior:'smooth'});
  } else {
    container.scrollTo({left:2*width, behavior:'smooth'});
  }
});

// ---------- VERTICAL SNAP FROM HERO TO PHOTOS ----------
let verticalTimeout;
window.addEventListener('scroll', ()=>{
  if(window.scrollY < photos.offsetTop - 10 || window.scrollY > photos.offsetTop + 10){
    clearTimeout(verticalTimeout);
    verticalTimeout = setTimeout(()=>{
      const scrollY = window.scrollY;
      if(scrollY < photos.offsetTop/2){
        window.scrollTo({top:0, behavior:'smooth'});
      } else {
        const firstSection = document.querySelector('#categories .category-section');
        if(firstSection) firstSection.scrollIntoView({behavior:'smooth'});
      }
    }, 80);
  }
});

// ---------- CONTENTFUL LOAD (unchanged) ----------
const SPACE_ID = '5w319pzc4eiq';
const ACCESS_TOKEN = 'l_S14vNHPLKqDVzZDxMSlO3g3AhMne9mAvyC74dyetg';
const ENVIRONMENT = 'master';

async function fetchPhotos(){
  const url = `https://cdn.contentful.com/spaces/${SPACE_ID}/environments/${ENVIRONMENT}/entries?content_type=photo&access_token=${ACCESS_TOKEN}&order=sys.createdAt&include=1`;
  const res = await fetch(url);
  if(!res.ok){ console.error('Contentful fetch failed', res.status); return; }
  const data = await res.json();

  const assets={};
  data.includes?.Asset?.forEach(a=>assets[a.sys.id]=a.fields.file.url);

  const photosData = data.items.map(item=>{
    const f=item.fields;
    return {
      title: f.title,
      photo: f.photo?`https:${assets[f.photo.sys.id]}`:'',
      thumbnail: f.thumbnail?`https:${assets[f.thumbnail.sys.id]}`:'',
      category: f.category || '',
      featured: f.featured || false
    };
  });
  displayPhotos(photosData);
}

function displayPhotos(photosData){
  const categoriesContainer = document.getElementById('categories');
  const allCategories = ["Featured","Double Exposures","Wildlife","Travel","Water","Light"];
  allCategories.forEach(cat=>{
    const items = (cat==="Featured")?photosData.filter(p=>p.featured):photosData.filter(p=>p.category===cat);
    if(items.length===0) return;
    const section = document.createElement('div'); section.className='category-section';
    const h2 = document.createElement('h2'); h2.textContent=cat; section.appendChild(h2);
    const grid = document.createElement('div'); grid.className='category-grid';
    items.forEach(p=>{
      const div = document.createElement('div'); div.className='category-item';
      const img = document.createElement('img'); img.src=p.thumbnail||p.photo; img.alt=p.title;
      div.appendChild(img); grid.appendChild(div);
    });
    section.appendChild(grid); categoriesContainer.appendChild(section);

    // Fade-in observer
    const observer = new IntersectionObserver(entries=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){ entry.target.classList.add('visible'); observer.unobserve(entry.target); }
      });
    }, {threshold:0.1});
    section.querySelectorAll('.category-item').forEach(item=>observer.observe(item));
  });
}

fetchPhotos();
</script>
